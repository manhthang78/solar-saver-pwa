<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Saver App</title>
    <!-- T·∫£i Tailwind CSS ƒë·ªÉ gi·ªØ nguy√™n phong c√°ch -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ƒê·ªãnh nghƒ©a Manifest cho PWA (B∆∞·ªõc quan tr·ªçng ƒë·ªÉ c√†i ƒë·∫∑t) -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10b981">
    
    <!-- T·∫£i React v√† ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- T·∫£i Babel ƒë·ªÉ x·ª≠ l√Ω JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- T·∫£i th∆∞ vi·ªán bi·ªÉu ƒë·ªì Recharts -->
    <script src="https://cdn.jsdelivr.net/npm/recharts/umd/Recharts.min.js"></script>

    <style>
        /* Thi·∫øt l·∫≠p font Inter cho ·ª©ng d·ª•ng */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
        }
        /* ƒê·∫£m b·∫£o ·ª©ng d·ª•ng ch·∫°y full height tr√™n mobile */
        #root {
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- B·∫Øt ƒë·∫ßu m√£ React Solar Saver ---

        // Import c√°c icon Lucide (S·ª≠ d·ª•ng SVG inline ƒë·ªÉ tr√°nh l·ªói import)
        const Icon = ({ name, size = 24, className = '', color = 'currentColor' }) => {
            const icons = {
                Home: props => <svg {...props} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
                History: props => <svg {...props} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-1.33 1.5"/><path d="M12 7v5l4 2"/></svg>,
                Settings: props => <svg {...props} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.2a2 2 0 0 1-1.4 1.4L4.77 7.77a2 2 0 0 0-1.12 1.95v.5a2 2 0 0 0 1.12 1.95l1.65 1.65a2 2 0 0 1 1.4 1.4v.2a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.2a2 2 0 0 1 1.4-1.4l1.65-1.65a2 2 0 0 0 1.12-1.95v-.5a2 2 0 0 0-1.12-1.95L15.34 6.2a2 2 0 0 1-1.4-1.4V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
                Trash2: props => <svg {...props} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M15 6V4c0-1-1-2-2-2h-2c-1 0-2 1-2 2v2"/></svg>,
                CheckCircle: props => <svg {...props} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg>,
                Clock: props => <svg {...props} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
                BarChart3: props => <svg {...props} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
            };
            const Component = icons[name];
            return Component ? <Component {...props} /> : null;
        };
        
        // FIX: Th√™m c∆° ch·∫ø b·∫£o v·ªá (safeguard) ƒë·ªÉ ƒë·∫£m b·∫£o window.Recharts ƒë√£ ƒë∆∞·ª£c t·∫£i.
        const Recharts = window.Recharts || {};
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;
        const { useState, useEffect, Fragment } = React;


        const TAX_RATE = 0.08; // 8% VAT

        function App() {
          // D·ªØ li·ªáu bi·ªÉu gi√° ƒëi·ªán kh·ªüi t·∫°o
          const initialElectricPrice = [
            { bac: 1, from: 0, to: 50, price: 1984 },
            { bac: 2, from: 51, to: 100, price: 2050 },
            { bac: 3, from: 101, to: 200, price: 2380 },
            { bac: 4, from: 201, to: 300, price: 2998 },
            { bac: 5, from: 301, to: 400, price: 3250 },
            { bac: 6, from: 401, to: 999999, price: 3398 }
          ];

          const [activeTab, setActiveTab] = useState('home');
          const [contracts, setContracts] = useState(2);
          const [priceUpdateDate, setPriceUpdateDate] = useState('10/05/2025'); // Ng√†y c·∫≠p nh·∫≠t gi√° ƒëi·ªán
          const [electricPriceState, setElectricPriceState] = useState(initialElectricPrice); // NEW STATE: Bi·ªÉu gi√° ƒëi·ªán trong tr·∫°ng th√°i
          
          const [investment, setInvestment] = useState({
            capacity: 9840,
            power: 14.3,
            cost: 150000000,
          });

          const [currentMonth, setCurrentMonth] = useState({
            month: new Date().toISOString().slice(0, 7), // Format: YYYY-MM
            evn: 350,
            solar: 600,
            maintenanceCost: 0, // Chi ph√≠ b·∫£o d∆∞·ª°ng th√°ng n√†y
          });

          const [history, setHistory] = useState([]);

          // H√†m c·∫≠p nh·∫≠t gi√° c·ªßa m·ªôt b·∫≠c thang c·ª• th·ªÉ
          const handlePriceChange = (index, newPrice) => {
            const priceValue = parseInt(newPrice) || 0;
            setElectricPriceState(prevPrices => 
              prevPrices.map((tier, i) => 
                i === index ? { ...tier, price: priceValue } : tier
              )
            );
          };

          // T√≠nh ti·ªÅn ƒëi·ªán theo b·∫≠c thang (c√≥ t√≠nh s·ªë h·ª£p ƒë·ªìng)
          const calculateElectricCost = (kwh) => {
            let totalCostBeforeTax = 0;
            let remaining = kwh;

            // S·ª¨ D·ª§NG TR·∫†NG TH√ÅI electricPriceState
            for (let tier of electricPriceState) {
              if (remaining <= 0) break;

              // T√≠nh s·ªë kWh c·ªßa b·∫≠c n√†y
              let tierKwh;
              if (tier.from === 0) {
                tierKwh = tier.to;
              } else {
                tierKwh = tier.to - tier.from + 1;
              }

              // Nh√¢n v·ªõi s·ªë h·ª£p ƒë·ªìng
              const tierCapacity = tierKwh * contracts;
              const usage = Math.min(remaining, tierCapacity);

              totalCostBeforeTax += usage * tier.price;
              remaining -= usage;
            }

            // C·ªông thu·∫ø GTGT 8%
            const totalCostWithTax = totalCostBeforeTax * (1 + TAX_RATE);

            return Math.round(totalCostWithTax);
          };

          const calculateSavings = () => {
            const totalUsage = currentMonth.evn + currentMonth.solar;
            const withoutSolar = calculateElectricCost(totalUsage);
            const actualCost = calculateElectricCost(currentMonth.evn);
            const monthlySavings = withoutSolar - actualCost; // Ti·∫øt ki·ªám g·ªôp (Gross Monthly Savings)

            // T√≠nh t·ªïng ti·∫øt ki·ªám g·ªôp t√≠ch l≈©y t·ª´ l·ªãch s·ª≠
            const grossTotalSavings = history.reduce((sum, record) => sum + record.savings, 0);

            // T√≠nh chi ph√≠ b·∫£o d∆∞·ª°ng t√≠ch l≈©y (T·ªïng h·ª£p t·ª´ l·ªãch s·ª≠)
            const totalMaintenancePaid = history.reduce((sum, record) => sum + record.maintenanceCost, 0);

            // T√≠nh ti·∫øt ki·ªám r√≤ng t√≠ch l≈©y (Net Accumulated Savings)
            const netTotalSavings = grossTotalSavings - totalMaintenancePaid;
            
            // T√≠nh l√£i t√≠ch l≈©y (Ch·ªâ khi ƒë√£ ho√†n v·ªën)
            const totalInvestment = investment.cost;
            const isFullyRecovered = netTotalSavings >= totalInvestment;
            const accumulatedProfit = isFullyRecovered ? netTotalSavings - totalInvestment : 0;
            
            // Ti·∫øt ki·ªám r√≤ng d√πng ƒë·ªÉ hi·ªÉn th·ªã (kh√¥ng bao gi·ªù √¢m n·∫øu ch∆∞a ho√†n v·ªën)
            const totalSavingsForDisplay = Math.max(0, netTotalSavings);

            // T√≠nh % ho√†n v·ªën/sinh l·ªùi
            const recoveryPercent = (netTotalSavings / totalInvestment) * 100;

            // T√≠nh trung b√¨nh ti·∫øt ki·ªám g·ªôp h√†ng th√°ng
            const avgMonthlyGrossSavings = history.length > 0
              ? grossTotalSavings / history.length
              : monthlySavings;

            // T√≠nh trung b√¨nh chi ph√≠ b·∫£o d∆∞·ª°ng h√†ng th√°ng
            const avgMonthlyMaintenance = history.length > 0
              ? totalMaintenancePaid / history.length
              : currentMonth.maintenanceCost; 

            // T√≠nh trung b√¨nh ti·∫øt ki·ªám r√≤ng h√†ng th√°ng
            const avgMonthlyNetSavings = avgMonthlyGrossSavings - avgMonthlyMaintenance;

            const remainingInvestment = totalInvestment - netTotalSavings;

            // D·ª± ki·∫øn ho√†n v·ªën: V·ªën c√≤n l·∫°i / Trung b√¨nh ti·∫øt ki·ªám r√≤ng h√†ng th√°ng
            const monthsToRecover = avgMonthlyNetSavings > 0
              ? Math.ceil(remainingInvestment / avgMonthlyNetSavings)
              : (remainingInvestment > 0 ? 9999 : 0); // 9999: Kh√¥ng th·ªÉ ho√†n v·ªën n·∫øu ti·∫øt ki·ªám r√≤ng √¢m

            return {
              totalUsage,
              withoutSolar,
              actualCost,
              monthlySavings: monthlySavings, // Gross monthly savings
              totalSavings: totalSavingsForDisplay, // Net accumulated savings for display
              recoveryPercent,
              monthsToRecover,
              avgMonthlySavings: avgMonthlyNetSavings,
              isFullyRecovered,
              accumulatedProfit,
            };
          };

          const savings = calculateSavings();

          const handleSaveMonth = () => {
            // Format th√°ng t·ª´ YYYY-MM sang "Th√°ng MM-YYYY"
            const [year, month] = currentMonth.month.split('-');
            const formattedMonth = `${month}-${year}`; // R√∫t g·ªçn ƒë·ªÉ hi·ªÉn th·ªã tr√™n tr·ª•c X

            const newRecord = {
              month: formattedMonth,
              evn: currentMonth.evn,
              solar: currentMonth.solar,
              maintenanceCost: currentMonth.maintenanceCost, // L∆ØU CHI PH√ç B·∫¢O D∆Ø·ª†NG TH√ÅNG
              cost: savings.actualCost,
              savings: savings.monthlySavings // L∆∞u savings g·ªôp (gross savings)
            };

            setHistory([...history, newRecord]);
            
            // Reset chi ph√≠ b·∫£o d∆∞·ª°ng v·ªÅ 0 sau khi l∆∞u
            setCurrentMonth(prev => ({ ...prev, maintenanceCost: 0 }));
          };

          // B·ªï sung: H√†m x√≥a d·ªØ li·ªáu nh·∫≠p sai
          const handleDeleteRecord = (index) => {
            const newHistory = history.filter((_, i) => i !== index);
            setHistory(newHistory);
          };

          // H√†m chu·∫©n b·ªã d·ªØ li·ªáu cho Bi·ªÉu ƒë·ªì
          const getChartData = () => {
            let accumulatedNetSavings = 0;
            return history.map(record => {
              // Net monthly savings = Gross monthly savings - Monthly maintenance cost
              const netMonthlySavings = record.savings - record.maintenanceCost;
              accumulatedNetSavings += netMonthlySavings;

              return {
                name: record.month,
                // Ti·∫øt ki·ªám r√≤ng t√≠ch l≈©y (so v·ªõi V·ªën ƒë·∫ßu t∆∞)
                'Ti·∫øt ki·ªám R√≤ng': accumulatedNetSavings,
                // ƒêi·ªÉm Ho√†n v·ªën (V·ªën ƒë·∫ßu t∆∞)
                'V·ªën ƒê·∫ßu T∆∞': investment.cost, 
              };
            });
          };

          const chartData = getChartData();
          
          // Component hi·ªÉn th·ªã th√¥ng tin Ho√†n v·ªën/L√£i t√≠ch l≈©y
          const RecoveryInfoCard = ({ savings, investment }) => {
            const { isFullyRecovered, accumulatedProfit, monthsToRecover, recoveryPercent } = savings;
            const investmentCost = investment.cost.toLocaleString('vi-VN');

            return (
              <div className={`rounded-xl shadow-lg p-6 text-white ${
                isFullyRecovered 
                  ? 'bg-gradient-to-r from-green-500 to-teal-500' 
                  : 'bg-gradient-to-r from-orange-500 to-yellow-500'
              }`}>
                <h3 className="text-xl font-bold mb-3">
                  {isFullyRecovered ? 'L√ÉI T√çCH LU·ª∏ S·ª¨ D·ª§NG SOLAR' : 'Th√¥ng tin Ho√†n v·ªën'} (ƒê√£ tr·ª´ B·∫£o d∆∞·ª°ng)
                </h3>
                
                <div className="flex items-center gap-2 mb-4 p-2 bg-white bg-opacity-20 rounded-lg">
                  {isFullyRecovered ? (
                    <Icon name="CheckCircle" size={20} className="text-white"/>
                  ) : (
                    <Icon name="Clock" size={20} className="text-white"/>
                  )}
                  <p className="text-sm font-semibold">
                    T√¨nh tr·∫°ng: {isFullyRecovered ? 'ƒê√£ ho√†n v·ªën, ƒëang sinh l·ªùi' : 'ƒêang trong qu√° tr√¨nh ho√†n v·ªën'}
                  </p>
                </div>

                <div className="grid md:grid-cols-2 gap-4">
                  <div>
                    <p className="text-sm opacity-90">V·ªën ƒë·∫ßu t∆∞</p>
                    <p className="text-2xl font-bold">{investmentCost} ƒë·ªìng</p>
                  </div>
                  
                  {isFullyRecovered ? (
                    <div>
                      <p className="text-sm opacity-90">L√£i r√≤ng t√≠ch l≈©y</p>
                      <p className="text-2xl font-bold">{accumulatedProfit.toLocaleString('vi-VN')} ƒë·ªìng</p>
                    </div>
                  ) : (
                    <div>
                      <p className="text-sm opacity-90">D·ª± ki·∫øn ho√†n v·ªën trong</p>
                      <p className="text-2xl font-bold">
                        {monthsToRecover === 9999 ? ' > 833 nƒÉm' : `${monthsToRecover} th√°ng`}
                      </p>
                    </div>
                  )}
                </div>
                
                {/* Progress Bar */}
                <div className="mt-4 bg-white bg-opacity-20 rounded-lg h-4 overflow-hidden">
                  <div
                    className="bg-white h-full transition-all duration-500"
                    style={{width: `${Math.min(recoveryPercent, 100)}%`}}
                  ></div>
                </div>
                <p className="text-sm opacity-90 text-right mt-1 font-medium">
                    M·ª©c ho√†n v·ªën/sinh l·ªùi: {recoveryPercent.toFixed(2)}%
                </p>
              </div>
            );
          };


          // Component Bi·ªÉu ƒë·ªì
          const AnalysisChart = ({ data, investmentCost }) => {
            // FIX: Ch·ªâ render bi·ªÉu ƒë·ªì n·∫øu c√≥ d·ªØ li·ªáu V√Ä LineChart ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng
            const isChartReady = data.length > 0 && LineChart; 

            return (
              <div className="bg-white rounded-xl shadow-lg p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                  <Icon name="BarChart3" size={24} className="text-blue-600"/> Ph√¢n t√≠ch Ho√†n v·ªën/Sinh l·ªùi
                </h2>
                {!isChartReady ? (
                  <div className="text-center py-10 text-gray-500">
                    {data.length === 0 ? 
                      'H√£y nh·∫≠p d·ªØ li·ªáu l·ªãch s·ª≠ ƒë·ªÉ xem bi·ªÉu ƒë·ªì ph√¢n t√≠ch.' : 
                      'L·ªói: Th∆∞ vi·ªán bi·ªÉu ƒë·ªì ch∆∞a ƒë∆∞·ª£c t·∫£i ƒë·∫ßy ƒë·ªß. Vui l√≤ng t·∫£i l·∫°i trang.'}
                  </div>
                ) : (
                  <ResponsiveContainer width="100%" height={400}>
                    <LineChart
                      data={data}
                      margin={{ top: 10, right: 30, left: 20, bottom: 5 }}
                    >
                      <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                      <XAxis dataKey="name" label={{ value: 'Th√°ng', position: 'bottom', fill: '#4b5563' }} />
                      {/* YAxis s·ª≠ d·ª•ng ƒë∆°n v·ªã ti·ªÅn t·ªá (VNƒê), format v·ªõi toLocaleString */}
                      <YAxis 
                        tickFormatter={(value) => value.toLocaleString('vi-VN')}
                        label={{ value: 'Ti·ªÅn (VNƒê)', angle: -90, position: 'left', fill: '#4b5563' }}
                      />
                      <Tooltip 
                        formatter={(value, name) => [`${value.toLocaleString('vi-VN')} ƒë`, name]}
                        labelFormatter={(label) => `Th√°ng ${label}`}
                        contentStyle={{ 
                          backgroundColor: '#ffffff', 
                          border: '1px solid #ccc', 
                          borderRadius: '8px', 
                          boxShadow: '0 4px 6px rgba(0,0,0,0.1)' 
                        }}
                      />
                      <Legend 
                        verticalAlign="top" 
                        height={36}
                        formatter={(value) => <span style={{ color: '#333' }}>{value}</span>}
                      />
                      {/* ƒê∆∞·ªùng Ti·∫øt ki·ªám R√≤ng (chuy·ªÉn t·ª´ ƒê·ªè sang Xanh khi ho√†n v·ªën) */}
                      <Line 
                        type="monotone" 
                        dataKey="Ti·∫øt ki·ªám R√≤ng" 
                        stroke="#10B981" 
                        strokeWidth={3} 
                        dot={true} 
                        activeDot={{ r: 8 }} 
                      />
                      {/* ƒê∆∞·ªùng V·ªën ƒê·∫ßu T∆∞ (ƒê∆∞·ªùng m·ªëc ho√†n v·ªën) */}
                      <Line 
                        type="monotone" 
                        dataKey="V·ªën ƒê·∫ßu T∆∞" 
                        stroke="#EF4444" 
                        strokeDasharray="5 5" 
                        strokeWidth={2}
                        dot={false}
                      />
                    </LineChart>
                  </ResponsiveContainer>
                )}
                <p className="mt-4 text-sm text-gray-600">
                  * ƒê·ªì th·ªã hi·ªÉn th·ªã: **Ti·∫øt ki·ªám R√≤ng T√≠ch l≈©y** (ƒë∆∞·ªùng Xanh) so v·ªõi **V·ªën ƒê·∫ßu T∆∞** (ƒë∆∞·ªùng ƒê·ªè). ƒêi·ªÉm giao nhau l√† ƒëi·ªÉm h√≤a v·ªën.
                </p>
              </div>
            );
          };


          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50">
              {/* Header */}
              <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6 shadow-lg">
                <h1 className="text-3xl font-bold flex items-center gap-2">
                  ‚òÄÔ∏è Solar Saver
                </h1>
                <p className="text-blue-100 mt-1">Theo d√µi ti·∫øt ki·ªám ƒëi·ªán m·∫∑t tr·ªùi</p>
              </div>
              {/* Main Content */}
              <div className="max-w-6xl mx-auto p-4">
                {activeTab === 'home' && (
                  <div className="space-y-6">
                    {/* Input Section */}
                    <div className="bg-white rounded-xl shadow-lg p-6">
                      <h2 className="text-2xl font-bold text-gray-800 mb-4">Nh·∫≠p li·ªáu th√°ng</h2>

                      <div className="grid md:grid-cols-4 gap-4"> {/* Grid 4 c·ªôt */}
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Th√°ng
                          </label>
                          <input
                            type="month"
                            value={currentMonth.month}
                            onChange={(e) => setCurrentMonth({...currentMonth, month: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            ƒêi·ªán l∆∞·ªõi (kWh)
                          </label>
                          <input
                            type="number"
                            value={currentMonth.evn}
                            onChange={(e) => setCurrentMonth({...currentMonth, evn: parseInt(e.target.value) || 0})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Solar (kWh)
                          </label>
                          <input
                            type="number"
                            value={currentMonth.solar}
                            onChange={(e) => setCurrentMonth({...currentMonth, solar: parseInt(e.target.value) || 0})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                          />
                        </div>
                        
                        {/* INPUT CHI PH√ç B·∫¢O D∆Ø·ª†NG TH√ÅNG */}
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Chi ph√≠ BD th√°ng n√†y (VNƒê)
                          </label>
                          <input
                            type="number"
                            value={currentMonth.maintenanceCost}
                            onChange={(e) => setCurrentMonth({...currentMonth, maintenanceCost: parseInt(e.target.value) || 0})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                          />
                        </div>
                      </div>
                    </div>

                    {/* Summary Cards */}
                    <div className="grid md:grid-cols-2 gap-6">
                      <div className="bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl shadow-lg p-6">
                        <div className="flex items-center justify-between mb-2">
                          <h3 className="text-lg font-semibold">N·∫øu kh√¥ng c√≥ Solar</h3>
                          <span className="text-3xl">‚ö°</span>
                        </div>
                        <p className="text-4xl font-bold mb-1">{savings.totalUsage} kWh</p>
                        <p className="text-2xl font-semibold">{savings.withoutSolar.toLocaleString('vi-VN')} ƒë·ªìng</p>
                      </div>
                      <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl shadow-lg p-6">
                        <div className="flex items-center justify-between mb-2">
                          <h3 className="text-lg font-semibold">Th·ª±c t·∫ø tr·∫£</h3>
                          <span className="text-3xl">üí∞</span>
                        </div>
                        <p className="text-4xl font-bold mb-1">{currentMonth.evn} kWh</p>
                        <p className="text-2xl font-semibold">{savings.actualCost.toLocaleString('vi-VN')} ƒë·ªìng</p>
                      </div>
                      <div className="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl shadow-lg p-6">
                        <div className="flex items-center justify-between mb-2">
                          <h3 className="text-lg font-semibold">Ti·∫øt ki·ªám th√°ng n√†y (G·ªôp)</h3>
                          <span className="text-3xl">‚òÄÔ∏è</span>
                        </div>
                        <p className="text-4xl font-bold mb-1">{currentMonth.solar} kWh</p>
                        <p className="text-2xl font-semibold">{savings.monthlySavings.toLocaleString('vi-VN')} ƒë·ªìng</p>
                      </div>
                      <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl shadow-lg p-6">
                        <div className="flex items-center justify-between mb-2">
                          <h3 className="text-lg font-semibold">T·ªïng ti·∫øt ki·ªám R√íNG t√≠ch l≈©y</h3>
                          <span className="text-3xl">üìà</span>
                        </div>
                        <p className="text-4xl font-bold mb-1">{savings.totalSavings.toLocaleString('vi-VN')} ƒë·ªìng</p>
                        <p className="text-2xl font-semibold">
                            {savings.isFullyRecovered ? 'ƒê√£ v∆∞·ª£t v·ªën ƒë·∫ßu t∆∞' : `C√≤n l·∫°i ${(investment.cost - savings.totalSavings).toLocaleString('vi-VN')} ƒë`}
                        </p>
                      </div>
                    </div>

                    {/* Recovery/Profit Info Card */}
                    <RecoveryInfoCard savings={savings} investment={investment} />

                    {/* Save Button */}
                    <button
                      onClick={handleSaveMonth}
                      className="w-full bg-gradient-to-r from-blue-600 to-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all"
                    >
                      üíæ L∆∞u d·ªØ li·ªáu th√°ng
                    </button>
                  </div>
                )}

                {activeTab === 'analysis' && (
                  <AnalysisChart data={chartData} investmentCost={investment.cost} />
                )}

                {activeTab === 'history' && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">L·ªãch s·ª≠ theo d√µi</h2>
                    <p className="text-sm text-gray-500 mb-4">
                      * M·ª©c **Ti·∫øt ki·ªám** ·ªü ƒë√¢y l√† ti·∫øt ki·ªám g·ªôp (ch∆∞a tr·ª´ chi ph√≠ b·∫£o d∆∞·ª°ng).
                    </p>
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead>
                          <tr className="bg-gradient-to-r from-blue-100 to-green-100">
                            <th className="px-4 py-3 text-left font-semibold">K·ª≥ s·ª≠ d·ª•ng</th>
                            <th className="px-4 py-3 text-right font-semibold">EVN</th>
                            <th className="px-4 py-3 text-right font-semibold">Solar</th>
                            <th className="px-4 py-3 text-right font-semibold">Th·ª±c t·∫ø tr·∫£</th>
                            <th className="px-4 py-3 text-right font-semibold">Chi ph√≠ BD</th> {/* C·ªôt m·ªõi */}
                            <th className="px-4 py-3 text-right font-semibold">Ti·∫øt ki·ªám (G·ªôp)</th>
                            <th className="px-4 py-3 text-center font-semibold">Thao t√°c</th>
                          </tr>
                        </thead>
                        <tbody>
                        {history.length === 0 ? (
                          <tr>
                            <td colSpan="7" className="px-4 py-8 text-center text-gray-500">
                              Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y th√™m d·ªØ li·ªáu th√°ng t·ª´ trang ch·ªß.
                            </td>
                          </tr>
                        ) : history.map((record, index) => (
                            <tr key={index} className="border-b hover:bg-gray-50">
                              <td className="px-4 py-3">{record.month}</td>
                              <td className="px-4 py-3 text-right">{record.evn} kWh</td>
                              <td className="px-4 py-3 text-right">{record.solar} kWh</td>
                              <td className="px-4 py-3 text-right font-semibold text-blue-600">
                                {record.cost.toLocaleString('vi-VN')} ƒë
                              </td>
                              <td className="px-4 py-3 text-right text-red-600">
                                {record.maintenanceCost.toLocaleString('vi-VN')} ƒë
                              </td>
                              <td className="px-4 py-3 text-right font-semibold text-green-600">
                                {record.savings.toLocaleString('vi-VN')} ƒë
                              </td>
                              <td className="px-4 py-3 text-center">
                                <button
                                  onClick={() => handleDeleteRecord(index)}
                                  className="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors"
                                  title="X√≥a d√≤ng n√†y"
                                >
                                  <Icon name="Trash2" size={18} />
                                </button>
                              </td>
                            </tr>
                          ))
                        }</tbody>
                        <tfoot>
                        {history.length > 0 ? (
                            <Fragment> 
                                <tr key="total" className="bg-gradient-to-r from-green-100 to-blue-100 font-bold">
                                    <td className="px-4 py-3" colSpan="3">T·ªïng c·ªông</td>
                                    <td className="px-4 py-3 text-right">
                                        {history.reduce((sum, r) => sum + r.cost, 0).toLocaleString('vi-VN')} ƒë
                                    </td>
                                    <td className="px-4 py-3 text-right text-red-600">
                                        {history.reduce((sum, r) => sum + r.maintenanceCost, 0).toLocaleString('vi-VN')} ƒë
                                    </td>
                                    <td className="px-4 py-3 text-right text-green-600">
                                        {history.reduce((sum, r) => sum + r.savings, 0).toLocaleString('vi-VN')} ƒë
                                    </td>
                                    <td></td>
                                </tr>
                                <tr key="average" className="bg-gradient-to-r from-blue-50 to-green-50 font-semibold">
                                    <td className="px-4 py-3" colSpan="3">Trung b√¨nh h√†ng th√°ng (G·ªôp)</td>
                                    <td className="px-4 py-3 text-right">
                                        {Math.round(history.reduce((sum, r) => sum + r.cost, 0) / history.length).toLocaleString('vi-VN')} ƒë
                                    </td>
                                    <td className="px-4 py-3 text-right text-red-600">
                                        {Math.round(history.reduce((sum, r) => sum + r.maintenanceCost, 0) / history.length).toLocaleString('vi-VN')} ƒë
                                    </td>
                                    <td className="px-4 py-3 text-right text-green-600">
                                        {Math.round(history.reduce((sum, r) => sum + r.savings, 0) / history.length).toLocaleString('vi-VN')} ƒë
                                    </td>
                                    <td></td>
                                </tr>
                            </Fragment>
                        ) : null}
                        </tfoot>
                      </table>
                    </div>
                  </div>
                )}

                {activeTab === 'settings' && (
                  <div className="space-y-6">
                    <div className="bg-white rounded-xl shadow-lg p-6">
                      <h2 className="text-2xl font-bold text-gray-800 mb-4">C√†i ƒë·∫∑t h·ªá th·ªëng</h2>

                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            S·ªë h·ª£p ƒë·ªìng/c√¥ng t∆°
                          </label>
                          <input
                            type="number"
                            value={contracts}
                            onChange={(e) => setContracts(parseInt(e.target.value) || 1)}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          />
                        </div>
                        {/* TH√äM INPUT NG√ÄY √ÅP D·ª§NG BI·ªÇU GI√Å */}
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Ng√†y √°p d·ª•ng bi·ªÉu gi√° (dd/mm/yyyy)
                          </label>
                          <input
                            type="text"
                            value={priceUpdateDate}
                            onChange={(e) => setPriceUpdateDate(e.target.value)}
                            placeholder="V√≠ d·ª•: 01/03/2025"
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          />
                        </div>
                      </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg p-6">
                      <h2 className="text-2xl font-bold text-gray-800 mb-4">M·ª©c ƒë·∫ßu t∆∞ Solar</h2>

                                    <div className="grid md:grid-cols-3 gap-4"> {/* Grid 3 c·ªôt sau khi b·ªè b·∫£o d∆∞·ª°ng */}
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            H·ªá (Wh)
                          </label>
                          <input
                            type="number"
                            value={investment.capacity}
                            onChange={(e) => setInvestment({...investment, capacity: parseInt(e.target.value) || 0})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            L∆∞u tr·ªØ (kW)
                          </label>
                          <input
                            type="number"
                            step="0.1"
                            value={investment.power}
                            onChange={(e) => setInvestment({...investment, power: parseFloat(e.target.value) || 0})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Th√†nh ti·ªÅn (VNƒê)
                          </label>
                          <input
                            type="number"
                            value={investment.cost}
                            onChange={(e) => setInvestment({...investment, cost: parseInt(e.target.value) || 0})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                          />
                        </div>
                      </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg p-6">
                      {/* ƒê·ªîI T√äN TI√äU ƒê·ªÄ */}
                      <h2 className="text-2xl font-bold text-gray-800 mb-4">Bi·ªÉu gi√° ƒëi·ªán sinh ho·∫°t</h2>
                      <div className="overflow-x-auto">
                        <table className="w-full">
                          <thead>
                            <tr className="bg-blue-100">
                              <th className="px-4 py-2 text-left">B·∫≠c</th>
                              <th className="px-4 py-2 text-center">T·ª´ (kWh)</th>
                              <th className="px-4 py-2 text-center">ƒê·∫øn (kWh)</th>
                              <th className="px-4 py-2 text-right">Gi√° (ƒë·ªìng/kWh)</th>
                            </tr>
                          </thead>
                          <tbody>
                            {/* S·ª¨ D·ª§NG electricPriceState V√Ä √î INPUT ƒê·ªÇ CH·ªàNH S·ª¨A GI√Å */}
                            {electricPriceState.map((tier, index) => (
                              <tr key={tier.bac} className="border-b hover:bg-gray-50">
                                <td className="px-4 py-2">B·∫≠c {tier.bac}</td>
                                <td className="px-4 py-2 text-center">{tier.from}</td>
                                <td className="px-4 py-2 text-center">{tier.to === 999999 ? '>' : tier.to}</td>
                                <td className="px-4 py-2 text-right font-semibold">
                                  <input
                                    type="number"
                                    value={tier.price}
                                    onChange={(e) => handlePriceChange(index, e.target.value)}
                                    className="w-28 text-right px-2 py-1 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-gray-900"
                                    min="0"
                                    step="10"
                                  />
                                  <span className="ml-1 text-gray-700">ƒë</span>
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                      <p className="mt-4 text-sm text-gray-600">
                        {/* TH√äM NG√ÄY C·∫¨P NH·∫¨T GI√Å */}
                        * Ng√†y c·∫≠p nh·∫≠t gi√°: <span className="font-semibold text-blue-600">{priceUpdateDate}</span><br/>
                        * V·ªõi {contracts} h·ª£p ƒë·ªìng, m·ª©c s·ª≠ d·ª•ng m·ªói b·∫≠c = m·ª©c g·ªëc √ó {contracts}<br/>
                        * V√≠ d·ª•: B·∫≠c 1 (0-50kWh) √ó {contracts} = 0-{50 * contracts}kWh<br/>
                        * Thu·∫ø GTGT: {TAX_RATE * 100}%
                      </p>
                    </div>
                  </div>
                )}
              </div>
              {/* Bottom Navigation */}
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg">
                <div className="max-w-6xl mx-auto flex justify-around">
                  <button
                    onClick={() => setActiveTab('home')}
                    className={`flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${
                      activeTab === 'home' ? 'text-blue-600 bg-blue-50' : 'text-gray-600'
                    }`}
                  >
                    <Icon name="Home" size={24} />
                    <span className="text-xs font-medium">Trang ch·ªß</span>
                  </button>
                  
                  <button
                    onClick={() => setActiveTab('analysis')}
                    className={`flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${
                      activeTab === 'analysis' ? 'text-blue-600 bg-blue-50' : 'text-gray-600'
                    }`}
                  >
                    <Icon name="BarChart3" size={24} />
                    <span className="text-xs font-medium">Ph√¢n t√≠ch</span>
                  </button>

                            <button
                    onClick={() => setActiveTab('history')}
                    className={`flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${
                      activeTab === 'history' ? 'text-blue-600 bg-blue-50' : 'text-gray-600'
                    }`}
                  >
                    <Icon name="History" size={24} />
                    <span className="text-xs font-medium">L·ªãch s·ª≠</span>
                  </button>

                            <button
                    onClick={() => setActiveTab('settings')}
                    className={`flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${
                      activeTab === 'settings' ? 'text-blue-600 bg-blue-50' : 'text-gray-600'
                    }`}
                  >
                    <Icon name="Settings" size={24} />
                    <span className="text-xs font-medium">C√†i ƒë·∫∑t</span>
                  </button>
                </div>
              </div>
              {/* Bottom Padding */}
              <div className="h-20"></div>
            </div>
          );
        }

        // --- K·∫øt th√∫c m√£ React Solar Saver ---

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

