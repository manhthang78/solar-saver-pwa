<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Theo d√µi ti·∫øt ki·ªám ƒëi·ªán m·∫∑t tr·ªùi">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Solar Saver - Theo d√µi ti·∫øt ki·ªám ƒëi·ªán m·∫∑t tr·ªùi</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" id="manifest-placeholder">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            margin: 0; 
            padding: 0; 
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #root { min-height: 100vh; }
        
        /* Prevent pull-to-refresh */
        body { overscroll-behavior-y: contain; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Generate manifest dynamically
        const manifestData = {
            "name": "Solar Saver",
            "short_name": "Solar Saver",
            "description": "Theo d√µi ti·∫øt ki·ªám ƒëi·ªán m·∫∑t tr·ªùi",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#2563eb",
            "orientation": "portrait-primary",
            "scope": "./",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect fill='%232563eb' width='192' height='192'/%3E%3Ctext x='96' y='130' font-size='100' text-anchor='middle' fill='%23fbbf24'%3E‚òÄÔ∏è%3C/text%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                },
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect fill='%232563eb' width='512' height='512'/%3E%3Ctext x='256' y='350' font-size='280' text-anchor='middle' fill='%23fbbf24'%3E‚òÄÔ∏è%3C/text%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'solar-saver-v1';
                
                self.addEventListener('install', event => {
                    self.skipWaiting();
                });
                
                self.addEventListener('activate', event => {
                    event.waitUntil(clients.claim());
                });
                
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                            .catch(() => caches.match('/'))
                    );
                });
            `;
            
            const swBlob = new Blob([swCode], {type: 'application/javascript'});
            const swURL = URL.createObjectURL(swBlob);
            
            navigator.serviceWorker.register(swURL)
                .then(() => console.log('SW registered'))
                .catch(err => console.error('SW registration failed:', err));
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icon Components
        const HomeIcon = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
        );

        const HistoryIcon = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
        );

        const SettingsIcon = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6"/>
            </svg>
        );

        const TrashIcon = ({ size = 18 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
        );

        const DownloadIcon = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );

        const UploadIcon = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
        );

        // Constants
        const DEFAULT_ELECTRIC_PRICE = [
            { bac: 1, from: 0, to: 50, price: 1984 },
            { bac: 2, from: 51, to: 100, price: 2050 },
            { bac: 3, from: 101, to: 200, price: 2380 },
            { bac: 4, from: 201, to: 300, price: 2998 },
            { bac: 5, from: 301, to: 400, price: 3350 },
            { bac: 6, from: 401, to: 999999, price: 3460 }
        ];

        const TAX_RATE = 0.08;

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            
            const [contracts, setContracts] = useState(() => {
                try {
                    const saved = localStorage.getItem('solar_contracts');
                    return saved ? parseInt(saved) : 2;
                } catch { return 2; }
            });
            
            const [electricPrice, setElectricPrice] = useState(() => {
                try {
                    const saved = localStorage.getItem('solar_electricPrice');
                    return saved ? JSON.parse(saved) : DEFAULT_ELECTRIC_PRICE;
                } catch { return DEFAULT_ELECTRIC_PRICE; }
            });
            
            const [priceUpdateDate, setPriceUpdateDate] = useState(() => {
                try {
                    return localStorage.getItem('solar_priceUpdateDate') || '2025-01-01';
                } catch { return '2025-01-01'; }
            });
            
            const [investment, setInvestment] = useState(() => {
                try {
                    const saved = localStorage.getItem('solar_investment');
                    return saved ? JSON.parse(saved) : { capacity: 9840, power: 14.3, cost: 150000000 };
                } catch { return { capacity: 9840, power: 14.3, cost: 150000000 }; }
            });
            
            const [currentMonth, setCurrentMonth] = useState({
                month: new Date().toISOString().slice(0, 7),
                evn: 350,
                solar: 600
            });
            
            const [history, setHistory] = useState(() => {
                try {
                    const saved = localStorage.getItem('solar_history');
                    return saved ? JSON.parse(saved) : [];
                } catch { return []; }
            });
            
            const [maintenance, setMaintenance] = useState(() => {
                try {
                    const saved = localStorage.getItem('solar_maintenance');
                    return saved ? JSON.parse(saved) : [];
                } catch { return []; }
            });
            
            const [newMaintenance, setNewMaintenance] = useState({
                date: new Date().toISOString().slice(0, 10),
                description: '',
                cost: 0
            });

            // Auto-save to localStorage
            useEffect(() => {
                try { localStorage.setItem('solar_contracts', contracts); } catch {}
            }, [contracts]);

            useEffect(() => {
                try { localStorage.setItem('solar_electricPrice', JSON.stringify(electricPrice)); } catch {}
            }, [electricPrice]);

            useEffect(() => {
                try { localStorage.setItem('solar_priceUpdateDate', priceUpdateDate); } catch {}
            }, [priceUpdateDate]);

            useEffect(() => {
                try { localStorage.setItem('solar_investment', JSON.stringify(investment)); } catch {}
            }, [investment]);

            useEffect(() => {
                try { localStorage.setItem('solar_history', JSON.stringify(history)); } catch {}
            }, [history]);

            useEffect(() => {
                try { localStorage.setItem('solar_maintenance', JSON.stringify(maintenance)); } catch {}
            }, [maintenance]);

            const calculateElectricCost = (kwh) => {
                let totalCostBeforeTax = 0;
                let remaining = kwh;
                
                for (let tier of electricPrice) {
                    if (remaining <= 0) break;
                    
                    let tierKwh;
                    if (tier.from === 0) {
                        tierKwh = tier.to;
                    } else {
                        tierKwh = tier.to - tier.from + 1;
                    }
                    
                    const tierCapacity = tierKwh * contracts;
                    const usage = Math.min(remaining, tierCapacity);
                    
                    totalCostBeforeTax += usage * tier.price;
                    remaining -= usage;
                }
                
                const totalCostWithTax = totalCostBeforeTax * (1 + TAX_RATE);
                return Math.round(totalCostWithTax);
            };

            const calculateSavings = () => {
                const totalUsage = currentMonth.evn + currentMonth.solar;
                const withoutSolar = calculateElectricCost(totalUsage);
                const actualCost = calculateElectricCost(currentMonth.evn);
                const monthlySavings = withoutSolar - actualCost;
                
                const totalSavings = history.reduce((sum, record) => sum + record.savings, 0);
                const totalMaintenance = maintenance.reduce((sum, record) => sum + record.cost, 0);
                const netSavings = totalSavings - totalMaintenance;
                const recoveryPercent = (netSavings / investment.cost) * 100;
                
                const avgMonthlySavings = history.length > 0 
                    ? history.reduce((sum, record) => sum + record.savings, 0) / history.length 
                    : monthlySavings;
                const remainingInvestment = investment.cost - netSavings;
                const monthsToRecover = avgMonthlySavings > 0 
                    ? Math.ceil(remainingInvestment / avgMonthlySavings) 
                    : 0;
                
                return {
                    totalUsage,
                    withoutSolar,
                    actualCost,
                    monthlySavings,
                    totalSavings,
                    totalMaintenance,
                    netSavings,
                    recoveryPercent,
                    monthsToRecover
                };
            };

            const savings = calculateSavings();

            const handleSaveMonth = () => {
                const [year, month] = currentMonth.month.split('-');
                const formattedMonth = `Th√°ng ${month}-${year}`;
                
                const newRecord = {
                    month: formattedMonth,
                    evn: currentMonth.evn,
                    solar: currentMonth.solar,
                    cost: savings.actualCost,
                    savings: savings.monthlySavings
                };
                
                setHistory([...history, newRecord]);
            };

            const handleDeleteRecord = (index) => {
                setHistory(history.filter((_, i) => i !== index));
            };

            const handleUpdatePrice = (index, field, value) => {
                const newPrices = [...electricPrice];
                newPrices[index][field] = parseInt(value) || 0;
                setElectricPrice(newPrices);
            };

            const handleResetPrice = () => {
                setElectricPrice(DEFAULT_ELECTRIC_PRICE);
                setPriceUpdateDate(new Date().toISOString().slice(0, 10));
            };

            const handleAddMaintenance = () => {
                if (!newMaintenance.description.trim() || newMaintenance.cost <= 0) return;
                
                setMaintenance([...maintenance, {
                    date: newMaintenance.date,
                    description: newMaintenance.description,
                    cost: parseInt(newMaintenance.cost)
                }]);
                
                setNewMaintenance({
                    date: new Date().toISOString().slice(0, 10),
                    description: '',
                    cost: 0
                });
            };

            const handleDeleteMaintenance = (index) => {
                setMaintenance(maintenance.filter((_, i) => i !== index));
            };

            const handleExportData = () => {
                const data = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    contracts,
                    electricPrice,
                    priceUpdateDate,
                    investment,
                    history,
                    maintenance
                };
                
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `solar-saver-backup-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            const handleImportData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.contracts) setContracts(data.contracts);
                        if (data.electricPrice) setElectricPrice(data.electricPrice);
                        if (data.priceUpdateDate) setPriceUpdateDate(data.priceUpdateDate);
                        if (data.investment) setInvestment(data.investment);
                        if (data.history) setHistory(data.history);
                        if (data.maintenance) setMaintenance(data.maintenance);
                    } catch (error) {
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 pb-20">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6 shadow-lg sticky top-0 z-10">
                        <h1 className="text-3xl font-bold">‚òÄÔ∏è Solar Saver</h1>
                        <p className="text-blue-100 mt-1">Theo d√µi ti·∫øt ki·ªám ƒëi·ªán m·∫∑t tr·ªùi</p>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-6xl mx-auto p-4">
                        {activeTab === 'home' && (
                            <div className="space-y-6">
                                {/* Input Section */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Nh·∫≠p li·ªáu th√°ng</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Th√°ng</label>
                                            <input
                                                type="month"
                                                value={currentMonth.month}
                                                onChange={(e) => setCurrentMonth({...currentMonth, month: e.target.value})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">ƒêi·ªán l∆∞·ªõi (kWh)</label>
                                            <input
                                                type="number"
                                                value={currentMonth.evn}
                                                onChange={(e) => setCurrentMonth({...currentMonth, evn: parseInt(e.target.value) || 0})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Solar (kWh)</label>
                                            <input
                                                type="number"
                                                value={currentMonth.solar}
                                                onChange={(e) => setCurrentMonth({...currentMonth, solar: parseInt(e.target.value) || 0})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Summary Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl shadow-lg p-6">
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="text-lg font-semibold">N·∫øu kh√¥ng c√≥ Solar</h3>
                                            <span className="text-3xl">‚ö°</span>
                                        </div>
                                        <p className="text-4xl font-bold mb-1">{savings.totalUsage} kWh</p>
                                        <p className="text-2xl font-semibold">{savings.withoutSolar.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                    </div>

                                    <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl shadow-lg p-6">
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="text-lg font-semibold">Th·ª±c t·∫ø tr·∫£</h3>
                                            <span className="text-3xl">üí∞</span>
                                        </div>
                                        <p className="text-4xl font-bold mb-1">{currentMonth.evn} kWh</p>
                                        <p className="text-2xl font-semibold">{savings.actualCost.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                    </div>

                                    <div className="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl shadow-lg p-6">
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="text-lg font-semibold">Ti·∫øt ki·ªám th√°ng n√†y</h3>
                                            <span className="text-3xl">‚òÄÔ∏è</span>
                                        </div>
                                        <p className="text-4xl font-bold mb-1">{currentMonth.solar} kWh</p>
                                        <p className="text-2xl font-semibold">{savings.monthlySavings.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                    </div>

                                    <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl shadow-lg p-6">
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="text-lg font-semibold">T·ªïng ti·∫øt ki·ªám t√≠ch l≈©y</h3>
                                            <span className="text-3xl">üìà</span>
                                        </div>
                                        <p className="text-4xl font-bold mb-1">{savings.recoveryPercent.toFixed(2)}%</p>
                                        <p className="text-2xl font-semibold">{savings.totalSavings.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                    </div>
                                </div>

                                {/* Recovery Info */}
                                <div className="bg-gradient-to-r from-orange-500 to-yellow-500 text-white rounded-xl shadow-lg p-6">
                                    {savings.netSavings >= investment.cost ? (
                                        <>
                                            <h3 className="text-xl font-bold mb-3">üéâ L√£i t√≠ch l≈©y s·ª≠ d·ª•ng solar</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <p className="text-sm opacity-90">V·ªën ƒë·∫ßu t∆∞ ƒë√£ ho√†n</p>
                                                    <p className="text-2xl font-bold">{investment.cost.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm opacity-90">Chi ph√≠ b·∫£o tr√¨</p>
                                                    <p className="text-2xl font-bold">{savings.totalMaintenance.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm opacity-90">T·ªïng l√£i r√≤ng</p>
                                                    <p className="text-2xl font-bold">{(savings.netSavings - investment.cost).toLocaleString('vi-VN')} ƒë·ªìng</p>
                                                </div>
                                            </div>
                                            <div className="mt-4 bg-white bg-opacity-20 rounded-lg p-3 text-center">
                                                <p className="text-sm opacity-90">Ho√†n v·ªën sau {history.length} th√°ng</p>
                                                <p className="text-3xl font-bold mt-1">‚úì ƒê√£ ho√†n v·ªën 100%</p>
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <h3 className="text-xl font-bold mb-3">Th√¥ng tin ho√†n v·ªën</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <p className="text-sm opacity-90">V·ªën ƒë·∫ßu t∆∞</p>
                                                    <p className="text-2xl font-bold">{investment.cost.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm opacity-90">Chi ph√≠ b·∫£o tr√¨</p>
                                                    <p className="text-2xl font-bold text-red-200">{savings.totalMaintenance.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm opacity-90">D·ª± ki·∫øn ho√†n v·ªën</p>
                                                    <p className="text-2xl font-bold">{savings.monthsToRecover} th√°ng</p>
                                                </div>
                                            </div>
                                            <div className="mt-3 text-center">
                                                <p className="text-sm opacity-90">L√£i r√≤ng hi·ªán t·∫°i</p>
                                                <p className="text-xl font-bold">{savings.netSavings.toLocaleString('vi-VN')} ƒë·ªìng</p>
                                            </div>
                                            <div className="mt-4 bg-white bg-opacity-20 rounded-lg h-4 overflow-hidden">
                                                <div 
                                                    className="bg-white h-full transition-all duration-500"
                                                    style={{width: `${Math.min(savings.recoveryPercent, 100)}%`}}
                                                />
                                            </div>
                                        </>
                                    )}
                                </div>

                                {/* Maintenance Summary */}
                                {maintenance.length > 0 && (
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-xl font-bold text-gray-800">Chi ph√≠ b·∫£o tr√¨ Solar</h3>
                                            <span className="text-2xl font-bold text-red-600">
                                                {savings.totalMaintenance.toLocaleString('vi-VN')} ƒë
                                            </span>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="w-full">
                                                <thead>
                                                    <tr className="bg-gradient-to-r from-red-50 to-orange-50">
                                                        <th className="px-4 py-2 text-left text-sm font-semibold">Ng√†y</th>
                                                        <th className="px-4 py-2 text-left text-sm font-semibold">M√¥ t·∫£</th>
                                                        <th className="px-4 py-2 text-right text-sm font-semibold">Chi ph√≠</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {maintenance.slice(-5).reverse().map((record, index) => (
                                                        <tr key={index} className="border-b hover:bg-gray-50">
                                                            <td className="px-4 py-2 text-sm">{new Date(record.date).toLocaleDateString('vi-VN')}</td>
                                                            <td className="px-4 py-2 text-sm">{record.description}</td>
                                                            <td className="px-4 py-2 text-right text-sm font-semibold text-red-600">
                                                                {record.cost.toLocaleString('vi-VN')} ƒë
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                        {maintenance.length > 5 && (
                                            <p className="text-sm text-gray-500 mt-2 text-center">
                                                Hi·ªÉn th·ªã 5 chi ph√≠ g·∫ßn nh·∫•t. Xem t·∫•t c·∫£ trong tab C√†i ƒë·∫∑t.
                                            </p>
                                        )}
                                    </div>
                                )}

                                {/* Save Button */}
                                <button
                                    onClick={handleSaveMonth}
                                    className="w-full bg-gradient-to-r from-blue-600 to-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl active:scale-95 transition-all"
                                >
                                    üíæ L∆∞u d·ªØ li·ªáu th√°ng
                                </button>
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-gray-800">L·ªãch s·ª≠ theo d√µi</h2>
                                    <div className="text-right">
                                        <p className="text-sm text-gray-600">S·ªë th√°ng ƒë√£ s·ª≠ d·ª•ng</p>
                                        <p className="text-3xl font-bold text-blue-600">{history.length}</p>
                                    </div>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="bg-gradient-to-r from-blue-100 to-green-100">
                                                <th className="px-4 py-3 text-left font-semibold">K·ª≥ s·ª≠ d·ª•ng</th>
                                                <th className="px-4 py-3 text-right font-semibold">EVN</th>
                                                <th className="px-4 py-3 text-right font-semibold">Solar</th>
                                                <th className="px-4 py-3 text-right font-semibold">Th·ª±c t·∫ø tr·∫£</th>
                                                <th className="px-4 py-3 text-right font-semibold">Ti·∫øt ki·ªám</th>
                                                <th className="px-4 py-3 text-center font-semibold">X√≥a</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {history.length === 0 ? (
                                                <tr>
                                                    <td colSpan="6" className="px-4 py-8 text-center text-gray-500">
                                                        Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y th√™m d·ªØ li·ªáu th√°ng t·ª´ trang ch·ªß.
                                                    </td>
                                                </tr>
                                            ) : (
                                                history.map((record, index) => (
                                                    <tr key={index} className="border-b hover:bg-gray-50">
                                                        <td className="px-4 py-3">{record.month}</td>
                                                        <td className="px-4 py-3 text-right">{record.evn} kWh</td>
                                                        <td className="px-4 py-3 text-right">{record.solar} kWh</td>
                                                        <td className="px-4 py-3 text-right font-semibold text-blue-600">
                                                            {record.cost.toLocaleString('vi-VN')} ƒë
                                                        </td>
                                                        <td className="px-4 py-3 text-right font-semibold text-green-600">
                                                            {record.savings.toLocaleString('vi-VN')} ƒë
                                                        </td>
                                                        <td className="px-4 py-3 text-center">
                                                            <button
                                                                onClick={() => handleDeleteRecord(index)}
                                                                className="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors active:scale-95"
                                                                type="button"
                                                            >
                                                                <TrashIcon />
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))
                                            )}
                                        </tbody>
                                        {history.length > 0 && (
                                            <tfoot>
                                                <tr className="bg-gradient-to-r from-green-100 to-blue-100 font-bold">
                                                    <td className="px-4 py-3" colSpan="3">T·ªïng c·ªông</td>
                                                    <td className="px-4 py-3 text-right">
                                                        {history.reduce((sum, r) => sum + r.cost, 0).toLocaleString('vi-VN')} ƒë
                                                    </td>
                                                    <td className="px-4 py-3 text-right text-green-600">
                                                        {history.reduce((sum, r) => sum + r.savings, 0).toLocaleString('vi-VN')} ƒë
                                                    </td>
                                                    <td></td>
                                                </tr>
                                                <tr className="bg-gradient-to-r from-blue-50 to-green-50 font-semibold">
                                                    <td className="px-4 py-3" colSpan="3">Trung b√¨nh h√†ng th√°ng</td>
                                                    <td className="px-4 py-3 text-right">
                                                        {Math.round(history.reduce((sum, r) => sum + r.cost, 0) / history.length).toLocaleString('vi-VN')} ƒë
                                                    </td>
                                                    <td className="px-4 py-3 text-right text-green-600">
                                                        {Math.round(history.reduce((sum, r) => sum + r.savings, 0) / history.length).toLocaleString('vi-VN')} ƒë
                                                    </td>
                                                    <td></td>
                                                </tr>
                                            </tfoot>
                                        )}
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <div className="space-y-6">
                                {/* Import/Export */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Sao l∆∞u & Kh√¥i ph·ª•c d·ªØ li·ªáu</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <button
                                            onClick={handleExportData}
                                            className="flex items-center justify-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 active:scale-95 transition-all font-semibold"
                                        >
                                            <DownloadIcon />
                                            Xu·∫•t d·ªØ li·ªáu (Export)
                                        </button>
                                        
                                        <label className="flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:scale-95 transition-all font-semibold cursor-pointer">
                                            <UploadIcon />
                                            Nh·∫≠p d·ªØ li·ªáu (Import)
                                            <input
                                                type="file"
                                                accept=".json"
                                                onChange={handleImportData}
                                                className="hidden"
                                            />
                                        </label>
                                    </div>
                                    <p className="mt-4 text-sm text-gray-600">
                                        üí° <strong>Xu·∫•t d·ªØ li·ªáu:</strong> T·∫£i file backup ƒë·ªÉ l∆∞u tr·ªØ ho·∫∑c chuy·ªÉn sang thi·∫øt b·ªã kh√°c<br/>
                                        üí° <strong>Nh·∫≠p d·ªØ li·ªáu:</strong> Kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ file backup
                                    </p>
                                </div>

                                {/* System Settings */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">C√†i ƒë·∫∑t h·ªá th·ªëng</h2>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">S·ªë h·ª£p ƒë·ªìng/c√¥ng t∆°</label>
                                        <input
                                            type="number"
                                            value={contracts}
                                            onChange={(e) => setContracts(parseInt(e.target.value) || 1)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>
                                </div>

                                {/* Investment */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">M·ª©c ƒë·∫ßu t∆∞ Solar</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">H·ªá (Wh)</label>
                                            <input
                                                type="number"
                                                value={investment.capacity}
                                                onChange={(e) => setInvestment({...investment, capacity: parseInt(e.target.value) || 0})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">L∆∞u tr·ªØ (kW)</label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                value={investment.power}
                                                onChange={(e) => setInvestment({...investment, power: parseFloat(e.target.value) || 0})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Th√†nh ti·ªÅn (VNƒê)</label>
                                            <input
                                                type="number"
                                                value={investment.cost}
                                                onChange={(e) => setInvestment({...investment, cost: parseInt(e.target.value) || 0})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Electric Price */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-2xl font-bold text-gray-800">Bi·ªÉu gi√° ƒëi·ªán sinh ho·∫°t</h2>
                                        <button
                                            onClick={handleResetPrice}
                                            className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 active:scale-95 transition-all text-sm"
                                        >
                                            Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh
                                        </button>
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Ng√†y c·∫≠p nh·∫≠t gi√° ƒëi·ªán</label>
                                        <input
                                            type="date"
                                            value={priceUpdateDate}
                                            onChange={(e) => setPriceUpdateDate(e.target.value)}
                                            className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead>
                                                <tr className="bg-blue-100">
                                                    <th className="px-4 py-2 text-left">B·∫≠c</th>
                                                    <th className="px-4 py-2 text-center">T·ª´ (kWh)</th>
                                                    <th className="px-4 py-2 text-center">ƒê·∫øn (kWh)</th>
                                                    <th className="px-4 py-2 text-right">Gi√° (ƒë·ªìng/kWh)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {electricPrice.map((tier, index) => (
                                                    <tr key={tier.bac} className="border-b">
                                                        <td className="px-4 py-2">B·∫≠c {tier.bac}</td>
                                                        <td className="px-4 py-2 text-center">
                                                            <input
                                                                type="number"
                                                                value={tier.from}
                                                                onChange={(e) => handleUpdatePrice(index, 'from', e.target.value)}
                                                                className="w-20 px-2 py-1 border rounded text-center"
                                                                disabled={tier.bac === 1}
                                                            />
                                                        </td>
                                                        <td className="px-4 py-2 text-center">
                                                            <input
                                                                type="number"
                                                                value={tier.to === 999999 ? '' : tier.to}
                                                                placeholder="‚àû"
                                                                onChange={(e) => handleUpdatePrice(index, 'to', e.target.value || 999999)}
                                                                className="w-20 px-2 py-1 border rounded text-center"
                                                            />
                                                        </td>
                                                        <td className="px-4 py-2 text-right">
                                                            <input
                                                                type="number"
                                                                value={tier.price}
                                                                onChange={(e) => handleUpdatePrice(index, 'price', e.target.value)}
                                                                className="w-28 px-2 py-1 border rounded text-right font-semibold"
                                                            />
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    <p className="mt-4 text-sm text-gray-600">
                                        * V·ªõi {contracts} h·ª£p ƒë·ªìng, m·ª©c s·ª≠ d·ª•ng m·ªói b·∫≠c = m·ª©c g·ªëc √ó {contracts}<br/>
                                        * V√≠ d·ª•: B·∫≠c 1 (0-50kWh) √ó {contracts} = 0-{50 * contracts}kWh<br/>
                                        * Thu·∫ø GTGT: {TAX_RATE * 100}%<br/>
                                        * C·∫≠p nh·∫≠t ng√†y: {new Date(priceUpdateDate).toLocaleDateString('vi-VN')}
                                    </p>
                                </div>

                                {/* Maintenance */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Chi ph√≠ b·∫£o tr√¨ Solar</h2>
                                    <div className="bg-blue-50 rounded-lg p-4 mb-4">
                                        <h3 className="font-semibold text-gray-700 mb-3">Th√™m chi ph√≠ b·∫£o tr√¨ m·ªõi</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Ng√†y</label>
                                                <input
                                                    type="date"
                                                    value={newMaintenance.date}
                                                    onChange={(e) => setNewMaintenance({...newMaintenance, date: e.target.value})}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">M√¥ t·∫£</label>
                                                <input
                                                    type="text"
                                                    placeholder="VD: V·ªá sinh t·∫•m pin"
                                                    value={newMaintenance.description}
                                                    onChange={(e) => setNewMaintenance({...newMaintenance, description: e.target.value})}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Chi ph√≠ (VNƒê)</label>
                                                <input
                                                    type="number"
                                                    value={newMaintenance.cost}
                                                    onChange={(e) => setNewMaintenance({...newMaintenance, cost: parseInt(e.target.value) || 0})}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                        </div>
                                        <button
                                            onClick={handleAddMaintenance}
                                            className="mt-3 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 active:scale-95 transition-all font-semibold"
                                        >
                                            ‚ûï Th√™m chi ph√≠ b·∫£o tr√¨
                                        </button>
                                    </div>

                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead>
                                                <tr className="bg-gradient-to-r from-red-100 to-orange-100">
                                                    <th className="px-4 py-3 text-left font-semibold">Ng√†y</th>
                                                    <th className="px-4 py-3 text-left font-semibold">M√¥ t·∫£</th>
                                                    <th className="px-4 py-3 text-right font-semibold">Chi ph√≠</th>
                                                    <th className="px-4 py-3 text-center font-semibold">X√≥a</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {maintenance.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="4" className="px-4 py-8 text-center text-gray-500">
                                                            Ch∆∞a c√≥ chi ph√≠ b·∫£o tr√¨ n√†o
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    maintenance.map((record, index) => (
                                                        <tr key={index} className="border-b hover:bg-gray-50">
                                                            <td className="px-4 py-3">{new Date(record.date).toLocaleDateString('vi-VN')}</td>
                                                            <td className="px-4 py-3">{record.description}</td>
                                                            <td className="px-4 py-3 text-right font-semibold text-red-600">
                                                                {record.cost.toLocaleString('vi-VN')} ƒë
                                                            </td>
                                                            <td className="px-4 py-3 text-center">
                                                                <button
                                                                    onClick={() => handleDeleteMaintenance(index)}
                                                                    className="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors active:scale-95"
                                                                    type="button"
                                                                >
                                                                    <TrashIcon />
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                            {maintenance.length > 0 && (
                                                <tfoot>
                                                    <tr className="bg-gradient-to-r from-orange-100 to-red-100 font-bold">
                                                        <td className="px-4 py-3" colSpan="2">T·ªïng chi ph√≠ b·∫£o tr√¨</td>
                                                        <td className="px-4 py-3 text-right text-red-700">
                                                            {maintenance.reduce((sum, r) => sum + r.cost, 0).toLocaleString('vi-VN')} ƒë
                                                        </td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            )}
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Bottom Navigation */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-20">
                        <div className="max-w-6xl mx-auto flex justify-around">
                            <button
                                onClick={() => setActiveTab('home')}
                                className={`flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${
                                    activeTab === 'home' ? 'text-blue-600 bg-blue-50' : 'text-gray-600'
                                }`}
                            >
                                <HomeIcon />
                                <span className="text-xs font-medium">Trang ch·ªß</span>
                            </button>
                            
                            <button
                                onClick={() => setActiveTab('history')}
                                className={`flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${
                                    activeTab === 'history' ? 'text-blue-600 bg-blue-50' : 'text-gray-600'
                                }`}
                            >
                                <HistoryIcon />
                                <span className="text-xs font-medium">L·ªãch s·ª≠</span>
                            </button>
                            
                            <button
                                onClick={() => setActiveTab('settings')}
                                className={`flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${
                                    activeTab === 'settings' ? 'text-blue-600 bg-blue-50' : 'text-gray-600'
                                }`}
                            >
                                <SettingsIcon />
                                <span className="text-xs font-medium">C√†i ƒë·∫∑t</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>